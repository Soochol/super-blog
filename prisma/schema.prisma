generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Product Domain
model Product {
  id           String   @id @default(uuid())
  maker        String
  model        String
  cpu          String
  ram          Int
  storage      String
  gpu          String
  displaySize  Float
  weight       Float
  os           String
  price        Int
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  crawls       CrawlHistory[]
  reviews      WebReviewReference[]
  critiques    ProductReview[]
  categories   CategoryAssignment[]
}

model CrawlHistory {
  id            String   @id @default(uuid())
  productId     String
  url           String
  htmlHash      String
  lastCrawledAt DateTime
  
  product       Product  @relation(fields: [productId], references: [id])
}

model WebReviewReference {
  id            String   @id @default(uuid())
  productId     String
  source        String
  url           String
  summaryText   String
  sentiment     String   // POSITIVE, NEUTRAL, NEGATIVE
  
  product       Product  @relation(fields: [productId], references: [id])
}

// Content Domain
model ProductReview {
  id                String   @id @default(uuid())
  productId         String
  summary           String
  pros              String[] // JSONB arrays
  cons              String[]
  recommendedFor    String
  notRecommendedFor String
  specHighlights    String[]
  strategy          Json?    // ProductStrategy structure
  sentimentAnalysis Json?    // SentimentAnalysis structure
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  product           Product  @relation(fields: [productId], references: [id])
}

// Category Domain
model Category {
  id                String   @id @default(uuid())
  name              String
  maxWeight         Float?
  minPrice          Int?
  maxPrice          Int?
  requiredGpuFamily String[]
  
  products          CategoryAssignment[]
}

model CategoryAssignment {
  productId  String
  categoryId String
  
  product    Product  @relation(fields: [productId], references: [id])
  category   Category @relation(fields: [categoryId], references: [id])
  
  @@id([productId, categoryId])
}

// Analytics Domain
model EventLog {
  id        String   @id @default(uuid())
  eventName String
  payload   Json
  timestamp DateTime
}

// Skill Domain
model AiSkill {
  id                   String @id @default(uuid())
  name                 String @unique
  systemPromptTemplate String
  userPromptTemplate   String
  temperature          Float
  model                String
  version              String
}
