# 04. 쿠팡파트너스 연동 (Coupang Partners Integration)

## 목적

모든 제품 페이지에서 쿠팡파트너스 제휴 링크를 통해 수익을 창출한다.
가격 추적, 링크 관리, 전환율 최적화가 핵심.

---

## 쿠팡파트너스 기본

| 항목 | 내용 |
|------|------|
| 수수료율 | 카테고리별 1~3% (대부분 3%) |
| 쿠키 기간 | 24시간 |
| 정산 | N월 수익 → N+2월 15일 지급 |
| 최소 출금 | 10,000원 |
| 링크 형태 | `https://link.coupang.com/re/AFFILIATE_CODE?...` |

---

## 링크 관리

### 링크 생성 프로세스

```
제품 등록 시:
  1. 쿠팡에서 해당 제품 검색 (제품명 + 모델번호)
  2. 최저가 상품 URL 확보
  3. 쿠팡파트너스 링크 생성 (추적 코드 포함)
  4. prices 테이블에 저장 (affiliate_url)

가격 갱신 시 (매일):
  1. 기존 링크 유효성 확인 (HTTP HEAD → 200)
  2. 가격 변동 확인
  3. 품절 시 대체 상품 검색
  4. prices 테이블 업데이트
```

### 링크 유효성 관리

| 상태 | 조건 | 대응 |
|------|------|------|
| 정상 | HTTP 200 + 재고 있음 | 유지 |
| 가격 변동 | 가격 10%+ 변동 | 가격 업데이트 + 콘텐츠 갱신 |
| 품절 | 재고 없음 | "품절" 표시 + 대체 상품 링크 |
| 링크 만료 | HTTP 404 | 새 링크 생성 |
| 상품 삭제 | 상품 페이지 없음 | 제품 비활성화 처리 |

---

## CTA 전략

### CTA 배치

| 페이지 | CTA 위치 | CTA 형태 | 개수 |
|--------|---------|---------|------|
| 카테고리 | 제품 카드마다 | "최저가 보기" 텍스트 링크 | N개 |
| 제품 상세 | 상단 + 스펙표 아래 + 하단 | "쿠팡에서 가격 확인" 버튼 | 3개 |
| 1:1 비교 | 양쪽 제품마다 + 결론 | "A 최저가" / "B 최저가" 버튼 | 3~4개 |
| 랭킹 | 각 순위 제품마다 | "가격 확인" 텍스트 링크 | N개 |
| 구매 가이드 | 추천 제품 섹션 | "추천 제품 보기" 버튼 | 2~3개 |

### CTA 디자인

```
[기본 버튼]
┌─────────────────────────┐
│  🛒 쿠팡 최저가 확인     │  ← 파란 배경, 흰 텍스트
│     1,590,000원~        │  ← 가격 표시
└─────────────────────────┘

[비교표 내]
  제품 A          제품 B
  ──────          ──────
  최저가 보기 →   최저가 보기 →   ← 텍스트 링크

[카드형]
┌──────────────────┐
│  [제품 이미지]    │
│  제품명           │
│  ★★★★☆ 장단점   │
│  1,590,000원     │
│  [최저가 보기]    │  ← 버튼
└──────────────────┘
```

### 면책 문구

모든 페이지 하단에 표시:
```
"이 포스팅은 쿠팡 파트너스 활동의 일환으로, 이에 따른 일정액의 수수료를 제공받습니다."
```

---

## 가격 추적

### 수집 주기

| 작업 | 주기 | 대상 |
|------|------|------|
| 전체 가격 갱신 | 일 1회 (08:00) | 전체 활성 제품 |
| 인기 제품 가격 | 일 2회 (08:00, 18:00) | 조회수 상위 20% |
| 할인 감지 | 일 1회 | 가격 하락 10%+ 제품 |

### 가격 이력 활용

```
prices 테이블에 매일 기록 →

활용:
1. 제품 페이지에 "가격 추이" 차트 표시
2. 할인 감지 → /deal/ 페이지에 자동 게시
3. "역대 최저가" 표시 → 구매 긴급성 유도
4. 가격 알림 기능 (향후)
```

---

## 전환율 최적화

### A/B 테스트 대상

| 테스트 | 변형 A | 변형 B |
|--------|--------|--------|
| CTA 문구 | "최저가 보기" | "쿠팡에서 가격 확인" |
| CTA 색상 | 파란색 | 주황색 (쿠팡 브랜드 색) |
| CTA 위치 | 스펙표 위 | 스펙표 아래 |
| 가격 표시 | 가격 숨김 | 가격 노출 |
| 비교표 | 텍스트 링크 | 버튼 |

### 추적

```
CTA 클릭 이벤트 → Google Analytics 커스텀 이벤트

{
  event: "cta_click",
  product_id: "xxx",
  page_type: "product_detail",  // product_detail / comparison / category
  cta_position: "top",          // top / middle / bottom
  cta_variant: "A"              // A/B 테스트 변형
}
```

---

## 리스크 및 대응

| 리스크 | 대응 |
|--------|------|
| 쿠팡파트너스 정책 변경 | 수수료율/정책 모니터링, 다른 제휴 프로그램 백업 |
| 링크 대량 만료 | 일일 유효성 배치 검사, 자동 재생성 |
| 전환율 하락 | A/B 테스트 지속, CTA 최적화 |
| 쿠팡 API 변경/제한 | 크롤링 백업, API 모니터링, **API 자격 정지 등 치명적 이벤트 시 긴급 알림 (Slack 등)** |
| 과도한 CTA → 사용자 이탈 | 페이지별 CTA 상한, 자연스러운 배치 |
